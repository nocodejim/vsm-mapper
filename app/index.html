<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Value Stream Map Mermaid Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Add a little extra spacing for clarity */
        .input-group {
            margin-bottom: 1rem;
            padding: 1rem;
            border: 1px solid #e2e8f0; /* border-gray-200 */
            border-radius: 0.375rem; /* rounded-md */
        }
        .input-group label, .title-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500; /* medium */
            color: #4b5563; /* text-gray-600 */
        }
         .input-group input, .title-group input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #cbd5e1; /* border-gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            box-sizing: border-box; /* Include padding and border in element's total width and height */
        }
         .title-group {
             margin-bottom: 1.5rem; /* More space before steps */
         }
        /* Style the remove button */
        .remove-btn {
             background-color: #f87171; /* bg-red-400 */
             color: white;
             padding: 0.25rem 0.5rem;
             border-radius: 0.375rem; /* rounded-md */
             font-size: 0.875rem; /* text-sm */
             cursor: pointer;
             margin-left: 0.5rem;
             border: none;
        }
        .remove-btn:hover {
             background-color: #ef4444; /* bg-red-500 */
        }
         /* Style the add button */
        .add-btn {
             background-color: #34d399; /* bg-emerald-400 */
             color: white;
             padding: 0.5rem 1rem;
             border-radius: 0.375rem; /* rounded-md */
             cursor: pointer;
             margin-top: 1rem;
             display: inline-block;
             border: none;
        }
        .add-btn:hover {
             background-color: #10b981; /* bg-emerald-500 */
        }
        /* Style the generate button */
        .generate-btn {
             background-color: #60a5fa; /* bg-blue-400 */
             color: white;
             padding: 0.75rem 1.5rem;
             border-radius: 0.375rem; /* rounded-md */
             cursor: pointer;
             font-size: 1rem; /* text-base */
             font-weight: 600; /* font-semibold */
             margin-top: 1.5rem;
             width: 100%;
             border: none;
        }
        .generate-btn:hover {
             background-color: #3b82f6; /* bg-blue-500 */
        }
        /* Style the output area */
        #mermaidOutput {
            font-family: monospace;
            white-space: pre;
            background-color: #f3f4f6; /* bg-gray-100 */
            border: 1px solid #d1d5db; /* border-gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 1rem;
            margin-top: 1.5rem;
            min-height: 200px; /* Ensure it has some height */
            overflow-x: auto; /* Allow horizontal scrolling if needed */
            width: 100%;
            box-sizing: border-box;
        }
         /* Style output action buttons */
         .output-actions {
             margin-top: 0.75rem; /* space above buttons */
             display: flex;
             gap: 0.5rem; /* space between buttons */
         }
         .output-actions button {
             padding: 0.5rem 1rem;
             border-radius: 0.375rem; /* rounded-md */
             cursor: pointer;
             font-weight: 500;
             border: none;
             transition: background-color 0.2s ease-in-out;
         }
         .output-actions button:disabled {
             opacity: 0.5;
             cursor: not-allowed;
         }
         #copyButton {
             background-color: #9ca3af; /* bg-gray-400 */
             color: white;
         }
         #copyButton:hover:not(:disabled) {
             background-color: #6b7280; /* bg-gray-500 */
         }
         #saveMarkdownBtn {
             background-color: #22c55e; /* bg-green-500 */
             color: white;
         }
         #saveMarkdownBtn:hover:not(:disabled) {
             background-color: #16a34a; /* bg-green-600 */
         }
         /* Footer Styling */
         footer {
             margin-top: 2rem; /* Space above footer */
             padding-top: 1rem; /* Space inside footer */
             border-top: 1px solid #e5e7eb; /* border-gray-200 */
             font-size: 0.875rem; /* text-sm */
             color: #6b7280; /* text-gray-500 */
         }
    </style>
</head>
<body class="bg-gray-50 font-sans p-8 flex flex-col min-h-screen">
    <div class="flex-grow max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-md w-full">
        <h1 class="text-2xl font-bold mb-6 text-center text-gray-700">Value Stream Map Mermaid Generator</h1>

        <form id="vsmForm">
            <div class="title-group">
                <label for="titleInput">Diagram Title (Optional, used for filename):</label>
                <input type="text" id="titleInput" name="titleInput" placeholder="e.g., My Awesome VSM">
            </div>

            <div id="stepsContainer">
                <div class="input-group" data-step-id="0">
                    <h3 class="text-lg font-semibold mb-2">Step 1</h3>
                    <label for="stepName0">Step Name:</label>
                    <input type="text" id="stepName0" name="stepName" required placeholder="e.g., Feature Request">

                    <label for="processTime0" class="mt-2">Process Time (e.g., '2 days'):</label>
                    <input type="text" id="processTime0" name="processTime" required placeholder="e.g., 2 days">

                    <label for="waitTime0" class="mt-2">Wait Time Before This Step (leave blank for first step):</label>
                    <input type="text" id="waitTime0" name="waitTime" placeholder="e.g., 5 days">
                    </div>
            </div>

            <button type="button" id="addStepBtn" class="add-btn">Add Another Step</button>

            <button type="submit" class="generate-btn">Generate Mermaid Code</button>
        </form>

        <div id="outputContainer" class="mt-6" style="display: none;">
            <h2 class="text-xl font-semibold mb-2 text-gray-700">Generated Mermaid Code:</h2>
            <p class="text-sm text-gray-600 mb-2">Review the code below. You can copy it directly or save it as a formatted Markdown file.</p>
            <textarea id="mermaidOutput" readonly class="w-full h-64"></textarea>

            <div class="output-actions">
                 <button id="copyButton" disabled>Copy Code</button>
                 <button id="saveMarkdownBtn" disabled>Save as Markdown (.md)</button>
            </div>
             <p id="copyFeedback" class="text-sm text-green-600 mt-1" style="display: none;">Copied to clipboard!</p>
             <p id="saveFeedback" class="text-sm text-blue-600 mt-1" style="display: none;">Markdown file download initiated.</p>
        </div>
    </div> <footer class="max-w-2xl mx-auto w-full mt-auto px-6 pb-6">
         <div class="flex justify-between items-center">
             <span>VSM Mapper Version: %%APP_VERSION%%</span>
             <span>Image Build: %%APP_VERSION%%</span>
         </div>
    </footer>

    <script>
        // --- SCRIPT START ---
        console.log("VSM Generator script loaded.");

        // --- Global Variables ---
        let stepCounter = 1; // Tracks the next step number to add

        // --- DOM Elements ---
        const form = document.getElementById('vsmForm');
        const titleInput = document.getElementById('titleInput');
        const stepsContainer = document.getElementById('stepsContainer');
        const addStepBtn = document.getElementById('addStepBtn');
        const outputContainer = document.getElementById('outputContainer');
        const mermaidOutput = document.getElementById('mermaidOutput');
        const copyButton = document.getElementById('copyButton');
        const saveMarkdownBtn = document.getElementById('saveMarkdownBtn');
        const copyFeedback = document.getElementById('copyFeedback');
        const saveFeedback = document.getElementById('saveFeedback');

        // --- Core Functions ---

        /**
         * Adds a new set of input fields for a VSM step.
         */
        function addStepInput() {
            console.log(`Adding step ${stepCounter + 1}`);
            const stepId = stepCounter; // Use current counter as ID for this new step

            const newStepDiv = document.createElement('div');
            newStepDiv.classList.add('input-group');
            newStepDiv.setAttribute('data-step-id', stepId); // Store the step ID

            // HTML structure for the new step input fields
            newStepDiv.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-lg font-semibold">Step ${stepId + 1}</h3>
                    <button type="button" class="remove-btn" onclick="removeStep(${stepId})">Remove</button>
                </div>
                <label for="stepName${stepId}">Step Name:</label>
                <input type="text" id="stepName${stepId}" name="stepName" required placeholder="e.g., Requirements">

                <label for="processTime${stepId}" class="mt-2">Process Time (e.g., '1 day'):</label>
                <input type="text" id="processTime${stepId}" name="processTime" required placeholder="e.g., 1 day">

                <label for="waitTime${stepId}" class="mt-2">Wait Time Before This Step (e.g., '5 days'):</label>
                <input type="text" id="waitTime${stepId}" name="waitTime" required placeholder="e.g., 5 days">
            `;

            stepsContainer.appendChild(newStepDiv);
            stepCounter++; // Increment counter for the *next* step to be added
            console.log(`Step ${stepId + 1} added. Next step will be ${stepCounter + 1}.`);
        }

        /**
         * Removes a step's input fields based on its ID.
         * @param {number} stepIdToRemove - The ID of the step input group to remove.
         */
        function removeStep(stepIdToRemove) {
            console.log(`Attempting to remove step with ID: ${stepIdToRemove}`);
            const stepToRemove = stepsContainer.querySelector(`[data-step-id="${stepIdToRemove}"]`);
            if (stepToRemove) {
                stepsContainer.removeChild(stepToRemove);
                console.log(`Successfully removed step with ID: ${stepIdToRemove}`);
                // Note: We don't re-number steps or decrement stepCounter to keep IDs unique
            } else {
                 console.warn(`Could not find step with ID: ${stepIdToRemove} to remove.`);
            }
        }

        /**
         * Extracts and validates data from all step input fields.
         * @returns {Array<Object>|null} An array of step objects if valid, otherwise null.
         */
        function getFormData() {
            console.log("Getting and validating form data...");
            const steps = [];
            const stepDivs = stepsContainer.querySelectorAll('.input-group');
            console.log(`Found ${stepDivs.length} step input groups.`);
            let isValid = true; // Assume valid initially

            if (stepDivs.length === 0) {
                console.warn("No steps found in the form.");
                alert("Error: Please add at least one step.");
                return null;
            }

            stepDivs.forEach((div, index) => {
                const stepId = div.getAttribute('data-step-id'); // Get the step's unique ID
                const stepNumber = index + 1; // User-facing step number (1-based)
                const nameInput = div.querySelector(`input[name="stepName"]`);
                const processTimeInput = div.querySelector(`input[name="processTime"]`);
                const waitTimeInput = div.querySelector(`input[name="waitTime"]`);

                let currentStepValid = true;
                // Validate Step Name
                if (!nameInput || !nameInput.value.trim()) {
                    console.error(`Validation Error: Step ${stepNumber} (ID: ${stepId}) is missing a name.`);
                    alert(`Error: Step ${stepNumber} must have a name.`);
                    isValid = false;
                    currentStepValid = false;
                }
                // Validate Process Time
                if (!processTimeInput || !processTimeInput.value.trim()) {
                     console.error(`Validation Error: Step ${stepNumber} (ID: ${stepId}) is missing process time.`);
                     alert(`Error: Step ${stepNumber} must have a process time.`);
                     isValid = false;
                     currentStepValid = false;
                }
                 // Validate Wait Time (Required for all steps except the first one, index 0)
                 if (index > 0 && (!waitTimeInput || !waitTimeInput.value.trim())) {
                     console.error(`Validation Error: Step ${stepNumber} (ID: ${stepId}) is missing wait time.`);
                     alert(`Error: Step ${stepNumber} must have a wait time (required for steps after the first).`);
                     isValid = false;
                     currentStepValid = false;
                 }

                // If all checks for this step passed, add its data
                if (currentStepValid) {
                    const stepData = {
                        id: `S${index}`, // Internal ID for Mermaid links (S0, S1, ...)
                        name: nameInput.value.trim(),
                        processTime: processTimeInput.value.trim(),
                        // Wait time is null only if it's the first step AND the input is empty
                        waitTime: (index === 0 && !waitTimeInput.value.trim()) ? null : waitTimeInput.value.trim()
                    };
                     console.log(`Data for Step ${stepNumber} (ID: ${stepData.id}):`, stepData);
                    steps.push(stepData);
                }
            });

            if (!isValid) {
                console.error("Form data validation failed overall.");
                return null; // Indicate validation failure
            }

            console.log("Form data collected and validated successfully:", steps);
            return steps;
        }

        /**
         * Generates the Mermaid diagram definition string from step data.
         * @param {Array<Object>} stepsData - Array of validated step objects.
         * @returns {string} The Mermaid diagram definition string.
         */
        function generateMermaidCode(stepsData) {
            console.log("Generating Mermaid code...");
            if (!stepsData || stepsData.length === 0) {
                console.warn("No step data provided to generate Mermaid code.");
                return "graph LR\n    %% No steps entered"; // Return basic empty graph
            }

            let mermaidString = "graph LR\n"; // Initialize Left-to-Right graph
            let totalProcessTime = 0;
            let totalWaitTime = 0;

            // 1. Define Nodes and Process Flow Links
            console.log("Adding process flow links...");
            for (let i = 0; i < stepsData.length; i++) {
                const step = stepsData[i];
                // Escape double quotes within the name to avoid breaking Mermaid syntax
                const escapedName = step.name.replace(/"/g, '#quot;');
                // Define the node: ID["Escaped Name"]
                mermaidString += `    ${step.id}["${escapedName}"]\n`;

                // Link to the next step with process time, if not the last step
                if (i < stepsData.length - 1) {
                    const nextStep = stepsData[i + 1];
                    mermaidString += `    ${step.id} -->|${step.processTime}| ${nextStep.id}\n`;
                }

                // Calculate total process time (attempt to parse number)
                const ptMatch = step.processTime.match(/\d+(\.\d+)?/); // Match integer or decimal
                if (ptMatch) {
                    totalProcessTime += parseFloat(ptMatch[0]);
                } else {
                    console.warn(`Could not parse process time number from: '${step.processTime}' for step ${i + 1}`);
                }
            }

            // 2. Add Wait Time Links (Dotted)
            console.log("Adding wait time links...");
            mermaidString += "\n    %% Add wait times\n";
            for (let i = 1; i < stepsData.length; i++) { // Start from the second step (index 1)
                const step = stepsData[i];
                const prevStep = stepsData[i - 1];
                // Wait time should exist for steps > 0 due to validation
                if (step.waitTime) {
                    mermaidString += `    ${prevStep.id} -.->|Wait: ${step.waitTime}| ${step.id}\n`;
                    // Calculate total wait time
                    const wtMatch = step.waitTime.match(/\d+(\.\d+)?/);
                    if (wtMatch) {
                        totalWaitTime += parseFloat(wtMatch[0]);
                    } else {
                        console.warn(`Could not parse wait time number from: '${step.waitTime}' for step ${i + 1}`);
                    }
                }
            }

            // 3. Add Metrics Subgraph
            console.log("Adding metrics subgraph...");
            const leadTime = totalProcessTime + totalWaitTime;
            // Calculate Flow Efficiency, handle potential division by zero
            const flowEfficiency = leadTime > 0 ? Math.round((totalProcessTime / leadTime) * 100) : 0;

            mermaidString += `\n    %% Add process metrics\n`;
            mermaidString += `    subgraph Metrics\n`;
            // Use 'units' as a generic time unit label
            mermaidString += `        PT[Process Time: ${totalProcessTime} units]\n`;
            mermaidString += `        LT[Lead Time: ${leadTime} units]\n`;
            mermaidString += `        FE[Flow Efficiency: ${flowEfficiency}%]\n`;
            mermaidString += `    end\n`; // Close subgraph

            console.log("Mermaid code generation complete.");
            return mermaidString;
        }

        /**
          * Handles the form submission: validates, generates code, updates UI.
          * @param {Event} event - The form submission event.
          */
         function handleSubmit(event) {
             event.preventDefault(); // Prevent default page reload
             console.log("Form submitted.");

             // Reset output state
             outputContainer.style.display = 'none';
             copyButton.disabled = true;
             saveMarkdownBtn.disabled = true;
             copyFeedback.style.display = 'none';
             saveFeedback.style.display = 'none';
             mermaidOutput.value = ''; // Clear previous output

             try {
                 // Get and validate form data
                 const formData = getFormData();

                 // If validation failed (returned null) or no steps, stop processing
                 if (!formData) {
                     console.warn("Form validation failed. Mermaid code not generated.");
                     return; // Exit function
                 }

                 // Generate the Mermaid code string
                 const mermaidCode = generateMermaidCode(formData);

                 // Update the UI
                 mermaidOutput.value = mermaidCode; // Display code in textarea
                 outputContainer.style.display = 'block'; // Show the output section
                 copyButton.disabled = false; // Enable action buttons
                 saveMarkdownBtn.disabled = false;
                 console.log("Mermaid code generated and displayed. Output buttons enabled.");

             } catch (error) {
                 // Catch unexpected errors during processing
                 console.error("Error during form submission or Mermaid generation:", error);
                 alert("An unexpected error occurred while generating the diagram. Check the console (F12) for details.");
                 // Ensure output is hidden on error
                 outputContainer.style.display = 'none';
             }
         }

        // --- Utility Functions ---

        /**
         * Copies the generated Mermaid code from the textarea to the clipboard.
         */
        function copyToClipboard() {
             if (copyButton.disabled) return; // Prevent action if button is disabled

             mermaidOutput.select(); // Select the text in the textarea
             mermaidOutput.setSelectionRange(0, 99999); // Ensure selection works on mobile

             try {
                 // Use the modern Clipboard API first
                 navigator.clipboard.writeText(mermaidOutput.value)
                     .then(() => {
                         console.log("Mermaid code copied to clipboard via Clipboard API.");
                         copyFeedback.style.display = 'inline'; // Show success feedback
                         saveFeedback.style.display = 'none';   // Hide other feedback
                         setTimeout(() => { copyFeedback.style.display = 'none'; }, 2000); // Hide after 2s
                     })
                     .catch(err => {
                         console.error('Failed to copy using navigator.clipboard: ', err);
                         copyUsingExecCommand(); // Attempt fallback if modern API fails
                     });
             } catch (err) {
                  console.error('Clipboard API access error or not supported: ', err);
                  copyUsingExecCommand(); // Attempt fallback if API access throws error
             }
         }

        /**
         * Fallback method for copying text using the older document.execCommand.
         * Less reliable and may be deprecated in browsers.
         */
         function copyUsingExecCommand() {
             try {
                 const successful = document.execCommand('copy'); // Attempt copy
                 if (successful) {
                     console.log("Mermaid code copied to clipboard (using execCommand fallback).");
                     copyFeedback.style.display = 'inline';
                     saveFeedback.style.display = 'none';
                     setTimeout(() => { copyFeedback.style.display = 'none'; }, 2000);
                 } else {
                     // execCommand returned false
                     console.error('execCommand fallback failed to copy.');
                     alert('Failed to copy text automatically. Please select the text and copy it manually (Ctrl+C or Cmd+C).');
                 }
             } catch (execErr) {
                 // execCommand threw an error
                 console.error('execCommand fallback failed with error: ', execErr);
                 alert('Failed to copy text automatically. Please select the text and copy it manually (Ctrl+C or Cmd+C).');
             }
         }

        /**
         * Pads a single-digit number with a leading zero.
         * @param {number} num - The number to pad.
         * @returns {string} The padded number as a string.
         */
        function padZero(num) {
            return num < 10 ? '0' + num : num.toString();
        }

        /**
         * Generates a filename for the Markdown file. Uses sanitized title or a timestamp.
         * @param {string} title - The title entered by the user in the title input field.
         * @returns {string} The generated filename ending in .md.
         */
        function getMarkdownFilename(title) {
            const trimmedTitle = title.trim();
            if (trimmedTitle) {
                // Sanitize title for use in filename:
                // 1. Replace whitespace sequences with single underscore
                // 2. Remove characters unsafe for filenames
                const sanitized = trimmedTitle
                    .replace(/\s+/g, '_')
                    .replace(/[\\/:*?"<>|#%&{}]/g, ''); // Removed more potentially problematic chars
                // Prevent empty filename after sanitization
                return sanitized ? `${sanitized}.md` : `vsm_diagram_${Date.now()}.md`;
            } else {
                // Generate timestamp-based filename if no title provided: MMDDHHMMSS.md
                const now = new Date();
                const month = padZero(now.getMonth() + 1); // Month is 0-indexed
                const day = padZero(now.getDate());
                const hours = padZero(now.getHours());
                const minutes = padZero(now.getMinutes());
                const seconds = padZero(now.getSeconds());
                return `vsm_${month}${day}_${hours}${minutes}${seconds}.md`;
            }
        }

        /**
         * Generates the full Markdown content string including title and fenced code block.
         * @param {string} title - The title entered by the user.
         * @param {string} mermaidCode - The generated Mermaid code string.
         * @param {string} filename - The generated filename (used for title if original title was blank).
         * @returns {string} The complete Markdown string ready for download.
         */
        function generateMarkdownContent(title, mermaidCode, filename) {
            // Use the provided title, or derive a title from the filename if the input was blank
            const displayTitle = title.trim() || filename.replace('.md', '').replace(/_/g, ' '); // Make filename title readable

            // Construct the Markdown string ensuring fences are on their own lines
            const markdownString = `# ${displayTitle}\n\n` + // Title H1, followed by blank line
                                  `Here is the visual representation of our process flow:\n\n` + // Explanatory text, blank line
                                  "```mermaid\n" +   // Opening fence with language identifier, newline
                                  mermaidCode + "\n" + // The Mermaid code itself, ensure it ends with newline
                                  "```\n\n" +        // Closing fence, newline, blank line
                                  `*Generated by VSM Mermaid Generator*`; // Footer text

            console.log("Generated Markdown Content:\n", markdownString); // Log the final markdown
            return markdownString;
        }


        /**
         * Creates a Blob and triggers a browser download for the given content.
         * @param {string} filename - The desired filename for the downloaded file.
         * @param {string} content - The text content to be included in the file.
         */
        function downloadFile(filename, content) {
            try {
                // Create a Blob (Binary Large Object) with the Markdown content
                const blob = new Blob([content], { type: 'text/markdown;charset=utf-8;' });

                // Create a temporary anchor element (link) to trigger the download
                const link = document.createElement("a");

                // Create a URL representing the Blob object
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url); // Set the link's target to the Blob URL
                link.setAttribute("download", filename); // Set the filename for the download
                link.style.visibility = 'hidden'; // Make the link invisible

                // Append the link to the document, click it, then remove it
                document.body.appendChild(link);
                link.click(); // Programmatically click the link to start download
                document.body.removeChild(link); // Clean up by removing the temporary link

                // Revoke the Blob URL to free up resources (important!)
                URL.revokeObjectURL(url);

                console.log(`Markdown file download initiated as: ${filename}`);
                // Show feedback message to the user
                saveFeedback.style.display = 'inline';
                copyFeedback.style.display = 'none'; // Hide other feedback
                setTimeout(() => { saveFeedback.style.display = 'none'; }, 3000); // Hide after 3s

            } catch(error) {
                 // Handle errors during file download process
                 console.error("Error triggering file download:", error);
                 alert("An error occurred while trying to save the file. Please try copying the code manually.");
                 saveFeedback.style.display = 'none'; // Hide feedback on error
            }
        }

        /**
         * Handles the click event for the "Save as Markdown" button.
         * Retrieves code, generates filename/content, and triggers download.
         */
        function handleSaveMarkdown() {
            if (saveMarkdownBtn.disabled) return; // Prevent action if button is disabled

            console.log("Save as Markdown button clicked.");
            const mermaidCode = mermaidOutput.value; // Get code from textarea

            // Basic check if there's code to save
            if (!mermaidCode || mermaidCode.startsWith("graph LR\n    %% No steps entered")) {
                alert("Please generate valid Mermaid code first before saving.");
                console.warn("Save attempt with no valid Mermaid code in output.");
                return;
            }

            // Get the title from the input field
            const title = titleInput.value;
            // Generate a suitable filename
            const filename = getMarkdownFilename(title);
            // Generate the full Markdown content string
            const markdownContent = generateMarkdownContent(title, mermaidCode, filename);

            // Trigger the download
            downloadFile(filename, markdownContent);
        }


        // --- Event Listeners Setup ---
        // Assign functions to button click/form submit events
        addStepBtn.addEventListener('click', addStepInput);
        form.addEventListener('submit', handleSubmit);
        copyButton.addEventListener('click', copyToClipboard);
        saveMarkdownBtn.addEventListener('click', handleSaveMarkdown);


        // --- Initial Page Setup ---
        console.log("Adding initial event listeners and setting initial state.");
        // Ensure output action buttons are disabled when the page first loads
        copyButton.disabled = true;
        saveMarkdownBtn.disabled = true;

        // --- SCRIPT END ---
    </script>
</body>
</html>
